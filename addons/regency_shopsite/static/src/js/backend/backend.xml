<?xml version="1.0" encoding="UTF-8"?>
<templates>

    <t t-inherit="web.FormView" t-inherit-mode="extension" owl="1">
        <xpath expr="//div[hasclass('o_form_view_container')]" position="attributes">
            <attribute name="t-att-class" add="model.root.resModel === 'overlay.template' ? 'form_view_for_overlay_template' : ''" separator=" "/>
        </xpath>
    </t>

    <t t-name="overlay_areas" owl="1">
        <div class="d-flex">
            <button t-if="!editMode and Object.keys(state.overlayPositions).length"
                    class="ot_edit_mode_btn btn btn-primary"
                    t-on-click="onClickToEditMode">
                Edit areas
            </button>
            <span style="height: 31px;"/>
        </div>
        <div class="overlay_template_widget">
            <div t-if="state.imagesListModalData"
                 t-portal="'body'"
                 class="ot_image_list_popup_overlay"
                 t-ref="image_list_modal">
                <div class="ot_image_list_popup">
                    <div class="ot_image_list_popup_header">
                        <span>Select image</span>
                        <i class="fa fa-close" t-on-click="onClickCloseImageListModal"/>
                    </div>
                    <div class="ot_image_list_popup_content">
                        <t t-foreach="filteredProductImageList" t-as="image" t-key="image.id">
                            <div class="ot_modal_image_container"
                                 t-att-class="{ 'disabled': !image.isAvailable }">
                                <img t-att-src="image.image.src"
                                     t-on-click="() => this.onClickImage(image.id)"/>
                                <span class="ot_modal_image_size">
                                    <t t-esc="image.image.width + 'x' + image.image.height"/>
                                </span>
                            </div>
                        </t>
                        <div class="ot_modal_image_container"
                             t-on-click="() => this.onClickImage(false)">
                            <span class="fa fa-remove"/>
                            Remove image
                        </div>
                    </div>
                </div>
            </div>
            <t t-if="state.productTemplateImagesLoaded">
                <t t-foreach="Object.values(state.overlayPositions)" t-as="position" t-key="position.id">
                    <OverlayAreasPositionComponent editMode="editMode"
                                                   productTemplateId="productTemplateId || 0"
                                                   overlayPositionId="position.id"
                                                   overlayPositionName="position.name"
                                                   areasImageAttributeId="areasImageAttributeId || 0"
                                                   areaList="position.areaList || {}"
                                                   selectedImages="position.selectedImages || {}"
                                                   areasImageValueList="areasImageAttributeValueList"
                                                   productTemplateImages="state.productTemplateImages"
                                                   allowEditAreas="!withOverlayProducts"
                                                   openImageListModal="(args) => this.openImageListModal(args)"/>
                </t>
            </t>
        </div>
    </t>

    <t t-name="overlay_areas_position" owl="1">
        <div class="ot_areas_position">
            <div class="ot_areas_position_header">
                <t t-esc="props.overlayPositionName"/>
                <div t-if="!!props.productTemplateId"
                     class="ot_areas_position_header_tab_buttons">
                    <button class="btn btn-secondary mx-2" t-on-click="onClickOpenAreasTab">
                        <i class="fa fa-object-group mx-2"/>Areas
                    </button>
                    <button class="btn btn-secondary" t-on-click="onClickOpenImagesTab">
                        <i class="fa fa-image mr-1"/>Images
                    </button>
                </div>
            </div>
            <div class="ot_areas_position_main" t-att-class="{ 'd-none': !props.productTemplateId }">
                <div class="ot_areas_tab" t-att-class="{ 'ot_areas_tab_hide': state.activeTab !== AREAS_TAB }">
                    <div t-if="props.editMode and props.allowEditAreas" class="ot_areas_position_tools">
                        <t t-if="!!state.editorImage">
                            <button class="btn btn-primary" t-on-click="onClickAddRectangleArea">
                                <i class="fa fa-plus-circle"/>Rectangle
                            </button>
                            <button class="btn btn-primary" t-on-click="onClickAddEllipseArea">
                                <i class="fa fa-plus-circle"/>Ellipse
                            </button>
                            <button class="btn btn-primary" t-on-click="onClickAddTextArea">
                                <i class="fa fa-plus-circle"/>Text
                            </button>
                        </t>
                    </div>
                    <div class="ot_areas_position_editor_block"
                         t-att-class="{ 'd-none': !state.editorImage }">
                        <div class="ot_areas_position_editor">
                            <img t-att-src="state.editorImage.src || ''"
                                 t-ref="image_ref"/>
                            <div class="ot_areas_position_canvas_container" t-ref="canvas_container_ref">
                                <canvas t-ref="canvas_ref"/>
                            </div>
                        </div>
                        <div t-if="showEditorImageSwitcher"
                             class="ot_areas_position_editor_image_switcher">
                            <t t-foreach="editorSwitcherImageList" t-as="item" t-key="item.valueId">
                                <div t-att-class="{ 'selected_color_image': item.valueId === state.editorSwitcherImageValueId }"
                                     t-on-click="() => this.onChangeEditorImage(item.valueId)">
                                    <img t-att-src="item.imageSrc"/>
                                    <span>
                                        <t t-esc="item.name"/>
                                    </span>
                                </div>
                            </t>
                        </div>
                    </div>
                    <t t-if="!state.editorImage">
                        <div class="ot_areas_position_non_image">
                            Please select image to start editing
                        </div>
                    </t>
                    <div class="ot_areas_position_area_list">
                    <t t-foreach="overlay ? Object.values(overlay.areaList) : []" t-as="area"
                       t-key="area.index">
                        <div class="ot_areas_position_area_list_item" t-on-click="() => this.onClickAreaListItem(area.index)"
                             t-att-class="{ 'ot_areas_position_area_list_item_selected': state.selectedAreaIndex === area.index }">
                            <div class="ot_areas_position_area_list_item_index">
                                <t t-esc="area.index"/>
                            </div>
                            <div class="ot_areas_position_area_list_item_data">
                                <t t-if="area.areaType === 'rectangle'">
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Width</span>
                                        <input type="number" t-att-value="area.data.width"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                    </div>
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Height</span>
                                        <input type="number" t-att-value="area.data.height"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                    </div>
                                </t>
                                <t t-if="area.areaType === 'ellipse'">
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Rx</span>
                                        <input type="number" t-att-value="area.data.rx"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                    </div>
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Ry</span>
                                        <input type="number" t-att-value="area.data.ry"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                    </div>
                                </t>
                                <t t-if="area.areaType === 'text'">
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Width</span>
                                        <input type="number" t-att-value="area.data.width"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                    </div>
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Font size</span>
                                        <input type="number" t-att-value="area.data.fontSize"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"
                                               t-on-change="() => this.onChangeTextFontSize(area.index)"/>
                                    </div>
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Lines</span>
                                        <input type="number" t-att-value="area.data.numberOfLines"
                                               t-att-disabled="!props.editMode || !props.allowEditAreas"
                                               t-on-change="() => this.onChangeTextNumberOfLines(area.index)"/>
                                    </div>
                                    <div class="ot_areas_position_area_list_item_data_value">
                                        <span>Font</span>
                                        <select t-att-disabled="!props.editMode || !props.allowEditAreas"
                                                t-on-change="() => this.onChangeTextFont(area.index)">
                                            <option t-att-selected="area.data.font == 'Arial'" value="Arial">Arial</option>
                                            <option t-att-selected="area.data.font == 'Times New Roman'" value="Times New Roman">Times New Roman</option>
                                            <option t-att-selected="area.data.font == 'Lato'" value="Lato">Lato</option>
                                            <option t-att-selected="area.data.font == 'Montserrat'" value="Montserrat">Montserrat</option>
                                            <option t-att-selected="area.data.font == 'Open_Sans'" value="Open_Sans">Open_Sans</option>
                                            <option t-att-selected="area.data.font == 'Oswald'" value="Oswald">Oswald</option>
                                            <option t-att-selected="area.data.font == 'Raleway'" value="Raleway">Raleway</option>
                                            <option t-att-selected="area.data.font == 'Roboto'" value="Roboto">Roboto</option>
                                        </select>
                                    </div>
                                </t>
                                <div class="ot_areas_position_area_list_item_data_value">
                                    <span>X</span>
                                    <input type="number" t-att-value="area.data.x"
                                           t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                </div>
                                <div class="ot_areas_position_area_list_item_data_value">
                                    <span>Y</span>
                                    <input type="number" t-att-value="area.data.y"
                                           t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                </div>
                                <div class="ot_areas_position_area_list_item_data_value">
                                    <span>Angle</span>
                                    <input type="number" t-att-value="area.data.angle"
                                           t-att-disabled="!props.editMode || !props.allowEditAreas"/>
                                </div>
                            </div>
                            <div t-if="props.editMode and props.allowEditAreas"
                                 class="ot_areas_position_area_list_item_remove"
                                 t-on-click.stop="() => this.onClickRemoveArea(area.index)">
                                <i class="fa fa-remove"/>
                            </div>
                        </div>
                    </t>
                </div>
                </div>
                <div class="ot_images_tab" t-att-class="{ 'd-none': state.activeTab !== IMAGES_TAB }">
                    <t t-foreach="areasImageValueList" t-as="value" t-key="value.id">
                        <div class="ot_images_tab_color_image_container">
                            <div class="ot_images_tab_color_image">
                                <button t-if="props.editMode"
                                        class="btn btn-primary ot_images_tab_color_image_change_btn"
                                        t-on-click="() => this.onClickChangeValueImage(value.id)">
                                    <i class="fa fa-image"/>
                                </button>
                                <t t-if="value.selectedImageSrc">
                                    <img t-att-src="value.selectedImageSrc"/>
                                </t>
                                <t t-else="">
                                    <div class="ot_images_tab_color_image_none">
                                        <span>Please select image</span>
                                    </div>
                                </t>
                            </div>
                            <div class="ot_images_tab_color_image_name">
                                <t t-esc="value.name"/>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
            <t t-if="!props.productTemplateId">
                <div class="ot_areas_position_non_product">
                    Please select product to start editing
                </div>
            </t>
        </div>
    </t>

</templates>
